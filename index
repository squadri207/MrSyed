<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2487.6">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; -webkit-text-stroke: #000000}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; -webkit-text-stroke: #000000; min-height: 14.0px}
    span.s1 {font-kerning: none}
  </style>
</head>
<body>
<p class="p1"><span class="s1">&lt;!DOCTYPE html&gt;</span></p>
<p class="p1"><span class="s1">&lt;html lang="en"&gt;</span></p>
<p class="p1"><span class="s1">&lt;head&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;meta charset="UTF-8"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;title&gt;Ionic Bonding - Bohr Model Simulation&lt;/title&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;script src="https://cdn.tailwindcss.com"&gt;&lt;/script&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;style&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>body {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>background-color: #e0f2fe; /* Light sky blue background */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>user-select: none;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>overflow: hidden;<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>height: 100vh;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>display: flex;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>align-items: center;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>justify-content: center;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.concord-sidebar {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border-left: 2px solid #bae6fd;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>background-color: #f8fafc;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.concord-button {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>background: linear-gradient(to bottom, #ffffff 0%, #f0f9ff 100%);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border: 1px solid #7dd3fc;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border-radius: 8px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>padding: 8px 20px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>font-size: 14px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>cursor: pointer;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>font-weight: bold;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>color: #0369a1;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>box-shadow: 0 2px 4px rgba(0,0,0,0.05);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>white-space: nowrap;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>transition: all 0.1s;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.concord-button:active {<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>transform: translateY(1px);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>box-shadow: none;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>background: #f0f9ff;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.concord-button:disabled { opacity: 0.5; cursor: not-allowed; }</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>select {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>padding: 6px 10px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border: 1px solid #7dd3fc;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border-radius: 6px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>font-size: 14px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>background: white;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>color: #0369a1;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.app-container {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>width: 100%;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>max-width: 1100px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>height: 90vh;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>display: flex;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>flex-direction: column;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>background: white;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border: 1px solid #bae6fd;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border-radius: 12px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>overflow: hidden;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>box-shadow: 0 10px 30px rgba(0,0,0,0.1);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>canvas {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>cursor: grab;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>canvas:active {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>cursor: grabbing;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/style&gt;</span></p>
<p class="p1"><span class="s1">&lt;/head&gt;</span></p>
<p class="p1"><span class="s1">&lt;body&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;div class="app-container"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;!-- Top Bar --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="bg-[#0284c7] text-white px-6 py-3 text-lg font-semibold flex justify-between shrink-0"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;span&gt;Bohr Model: Ionic Bonding Simulation&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;span class="opacity-80 text-sm"&gt;Interactive Science Lab&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="flex flex-grow overflow-hidden"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;!-- Main Simulation Area --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="relative flex-grow flex flex-col min-w-0 bg-white"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="flex-grow relative border-b border-sky-100"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;canvas id="canvas" class="absolute inset-0 w-full h-full"&gt;&lt;/canvas&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;!-- Controls Overlay --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="shrink-0 flex gap-6 items-center p-4 bg-slate-50"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="flex items-center gap-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;label class="text-sm font-bold text-slate-700 whitespace-nowrap"&gt;Compound:&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;select id="compoundSelect"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;option value="NaCl"&gt;NaCl (Table Salt)&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;option value="MgCl2"&gt;MgCl₂ (Magnesium Chloride)&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;option value="LiCl"&gt;LiCl (Lithium Chloride)&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;option value="MgO"&gt;MgO (Magnesium Oxide)&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;option value="Li2O"&gt;Li₂O (Lithium Oxide)&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;option value="CaCl2"&gt;CaCl₂ (Calcium Chloride)&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;option value="MgF2"&gt;MgF₂ (Magnesium Fluoride)&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/select&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;button id="ionizeBtn" class="concord-button"&gt;Ionize&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;button id="resetBtn" class="concord-button text-slate-500"&gt;Reset&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;!-- Sidebar --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="concord-sidebar w-72 p-6 flex flex-col gap-6 shrink-0 overflow-y-auto"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;h3 class="text-xs font-bold uppercase text-slate-400 mb-2 tracking-wider"&gt;Simulation State&lt;/h3&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div id="stateLabel" class="text-sm font-bold text-sky-700 bg-white p-3 border border-sky-200 rounded-lg text-center shadow-sm"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>Neutral Atoms</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="text-sm text-slate-700 bg-white p-5 border border-slate-200 rounded-xl leading-relaxed shadow-sm"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;h4 class="font-bold text-slate-900 mb-3 border-b pb-1"&gt;How to play:&lt;/h4&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;ul class="space-y-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;li class="flex items-start gap-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;span class="bg-sky-100 text-sky-700 w-5 h-5 rounded-full flex items-center justify-center text-[10px] shrink-0 mt-0.5 font-bold"&gt;1&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;span&gt;&lt;b&gt;Drag&lt;/b&gt; atoms to move them around the screen.&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/li&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;li class="flex items-start gap-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;span class="bg-sky-100 text-sky-700 w-5 h-5 rounded-full flex items-center justify-center text-[10px] shrink-0 mt-0.5 font-bold"&gt;2&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;span&gt;Click &lt;b&gt;Ionize&lt;/b&gt; to transfer electrons from metal to non-metal.&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/li&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;li class="flex items-start gap-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;span class="bg-sky-100 text-sky-700 w-5 h-5 rounded-full flex items-center justify-center text-[10px] shrink-0 mt-0.5 font-bold"&gt;3&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;span&gt;Watch as the newly formed ions &lt;b&gt;attract and bond&lt;/b&gt;!&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/li&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/ul&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;script&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const canvas = document.getElementById('canvas');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const ctx = canvas.getContext('2d');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const compoundSelect = document.getElementById('compoundSelect');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const ionizeBtn = document.getElementById('ionizeBtn');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const resetBtn = document.getElementById('resetBtn');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const stateLabel = document.getElementById('stateLabel');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>let atoms = [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>let isIonizing = false;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>let transferComplete = false;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>let draggedAtom = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>let mousePos = { x: 0, y: 0 };</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const ELEMENT_DATA = {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>'Li': { shells: [2, 1], color: '#f0abfc', symbol: 'Li' },<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>'Na': { shells: [2, 8, 1], color: '#818cf8', symbol: 'Na' },<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>'Mg': { shells: [2, 8, 2], color: '#38bdf8', symbol: 'Mg' },<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>'Ca': { shells: [2, 8, 8, 2], color: '#60a5fa', symbol: 'Ca' },<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>'F':<span class="Apple-converted-space">  </span>{ shells: [2, 7], color: '#4ade80', symbol: 'F' }, <span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>'Cl': { shells: [2, 8, 7], color: '#a3e635', symbol: 'Cl' },<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>'O':<span class="Apple-converted-space">  </span>{ shells: [2, 6], color: '#fb923c', symbol: 'O' }<span class="Apple-converted-space">   </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const COMPOUNDS = {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>'NaCl':<span class="Apple-converted-space">  </span>{ metals: [{type: 'Na', x: 0.35, y: 0.5}], nonmetals: [{type: 'Cl', x: 0.65, y: 0.5}] },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>'MgCl2': { metals: [{type: 'Mg', x: 0.5, y: 0.5}], nonmetals: [{type: 'Cl', x: 0.3, y: 0.3}, {type: 'Cl', x: 0.7, y: 0.7}] },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>'LiCl':<span class="Apple-converted-space">  </span>{ metals: [{type: 'Li', x: 0.35, y: 0.5}], nonmetals: [{type: 'Cl', x: 0.65, y: 0.5}] },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>'MgO': <span class="Apple-converted-space">  </span>{ metals: [{type: 'Mg', x: 0.35, y: 0.5}], nonmetals: [{type: 'O', x: 0.65, y: 0.5}] },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>'Li2O':<span class="Apple-converted-space">  </span>{ metals: [{type: 'Li', x: 0.3, y: 0.3}, {type: 'Li', x: 0.3, y: 0.7}], nonmetals: [{type: 'O', x: 0.7, y: 0.5}] },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>'CaCl2': { metals: [{type: 'Ca', x: 0.5, y: 0.5}], nonmetals: [{type: 'Cl', x: 0.3, y: 0.3}, {type: 'Cl', x: 0.7, y: 0.7}] },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>'MgF2':<span class="Apple-converted-space">  </span>{ metals: [{type: 'Mg', x: 0.5, y: 0.5}], nonmetals: [{type: 'F', x: 0.3, y: 0.3}, {type: 'F', x: 0.7, y: 0.7}] }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>class Electron {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>constructor(atom, shellIndex, angle) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>this.atom = atom;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>this.shellIndex = shellIndex;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>this.angle = angle;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>this.isTransferring = false;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>this.targetAtom = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>this.targetAngle = 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>this.progress = 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>getPosition() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const shellRadius = this.shellIndex * 22 + 18;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if (this.isTransferring &amp;&amp; this.targetAtom) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>const startX = this.atom.x + Math.cos(this.angle) * shellRadius;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>const startY = this.atom.y + Math.sin(this.angle) * shellRadius;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>const targetShellRadius = this.targetAtom.currentShells.length * 22 + 18;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>const endX = this.targetAtom.x + Math.cos(this.targetAngle) * targetShellRadius;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>const endY = this.targetAtom.y + Math.sin(this.targetAngle) * targetShellRadius;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>return {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>x: startX + (endX - startX) * this.progress,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>y: startY + (endY - startY) * this.progress</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>};</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>return {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>x: this.atom.x + Math.cos(this.angle) * shellRadius,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>y: this.atom.y + Math.sin(this.angle) * shellRadius</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>};</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>draw() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const pos = this.getPosition();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>ctx.beginPath();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>ctx.arc(pos.x, pos.y, 4, 0, Math.PI * 2);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>ctx.fillStyle = '#facc15';<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>ctx.fill();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>ctx.strokeStyle = '#854d0e';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>ctx.lineWidth = 1;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>ctx.stroke();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>class Atom {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>constructor(relX, relY, type, isMetal) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>this.relX = relX;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>this.relY = relY;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>this.x = 0; this.y = 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>this.vx = 0; this.vy = 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>this.type = type;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>this.isMetal = isMetal;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>this.data = ELEMENT_DATA[type];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>this.isIon = false;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>this.currentShells = [...this.data.shells];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>this.electrons = [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>this.initElectrons();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>initElectrons() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>this.currentShells.forEach((count, sIdx) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>for (let i = 0; i &lt; count; i++) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>const angle = (i / count) * Math.PI * 2 - Math.PI/2;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>this.electrons.push(new Electron(this, sIdx + 1, angle));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>rebalanceElectrons() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const valenceShellIdx = this.currentShells.length;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const valenceElectrons = this.electrons.filter(e =&gt; e.shellIndex === valenceShellIdx);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>valenceElectrons.forEach((e, i) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>e.angle = (i / valenceElectrons.length) * Math.PI * 2 - Math.PI/2;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>getRadius() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const shellCount = (this.isIon &amp;&amp; this.isMetal) ? this.currentShells.length - 1 : this.currentShells.length;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>return shellCount * 22 + 18;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>draw() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if (draggedAtom !== this) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>this.x = canvas.width * this.relX;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>this.y = canvas.height * this.relY;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const shellCount = (this.isIon &amp;&amp; this.isMetal) ? this.currentShells.length - 1 : this.currentShells.length;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>this.hitRadius = this.getRadius();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>// Shells</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>ctx.setLineDash([5, 5]);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>ctx.strokeStyle = draggedAtom === this ? '#0ea5e9' : '#e2e8f0';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>ctx.lineWidth = 1.5;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>for (let i = 1; i &lt;= shellCount; i++) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>ctx.beginPath();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>ctx.arc(this.x, this.y, i * 22 + 18, 0, Math.PI * 2);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>ctx.stroke();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>ctx.setLineDash([]);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>// Nucleus</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>ctx.beginPath();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const coreRad = (this.isIon &amp;&amp; this.isMetal) ? 18 : 22;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>ctx.arc(this.x, this.y, coreRad, 0, Math.PI * 2);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>ctx.fillStyle = this.data.color;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>ctx.fill();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>ctx.strokeStyle = '#334155';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>ctx.lineWidth = 2;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>ctx.stroke();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>// Text (Symbol and Charge as Superscript)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>ctx.fillStyle = '#1e293b';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>ctx.textAlign = 'center';</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>// Draw Symbol</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>ctx.font = 'bold 16px Arial';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const metrics = ctx.measureText(this.type);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>ctx.fillText(this.type, this.x - (this.isIon ? 5 : 0), this.y + 6);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>// Draw Charge as Superscript if Ion</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if (this.isIon) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>const valenceCount = this.data.shells[this.data.shells.length - 1];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>let chargeText = "";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>if (this.isMetal) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>chargeText = valenceCount &gt; 1 ? valenceCount + "+" : "+";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>const needed = 8 - valenceCount;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>chargeText = needed &gt; 1 ? needed + "-" : "-";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>ctx.font = 'bold 11px Arial';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>ctx.textAlign = 'left';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>ctx.fillText(chargeText, this.x + (metrics.width/2) - 3, this.y - 2);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>this.electrons.forEach(e =&gt; e.draw());</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>function setupCompound() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>atoms = [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>transferComplete = false;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const comp = COMPOUNDS[compoundSelect.value];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>comp.metals.forEach(m =&gt; atoms.push(new Atom(m.x, m.y, m.type, true)));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>comp.nonmetals.forEach(nm =&gt; atoms.push(new Atom(nm.x, nm.y, nm.type, false)));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>isIonizing = false;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>ionizeBtn.disabled = false;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>stateLabel.innerText = "Neutral Atoms";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>stateLabel.className = "text-sm font-bold text-sky-700 bg-white p-3 border border-sky-200 rounded-lg text-center shadow-sm";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>function triggerIonization() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (isIonizing) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>isIonizing = true;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>ionizeBtn.disabled = true;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>stateLabel.innerText = "Transferring Electrons...";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>stateLabel.className = "text-sm font-bold text-orange-600 bg-white p-3 border border-orange-200 rounded-lg text-center shadow-sm";</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const metals = atoms.filter(a =&gt; a.isMetal);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const nonmetals = atoms.filter(a =&gt; !a.isMetal);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>let eIdx = 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>metals.forEach(m =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const valenceElectrons = m.electrons.filter(e =&gt; e.shellIndex === m.currentShells.length);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>valenceElectrons.forEach((ve) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>ve.isTransferring = true;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>const target = nonmetals[eIdx % nonmetals.length];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>ve.targetAtom = target;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>ve.targetAngle = Math.random() * Math.PI * 2;<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>eIdx++;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>function handleDragging() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (draggedAtom) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>draggedAtom.x = mousePos.x;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>draggedAtom.y = mousePos.y;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>draggedAtom.relX = draggedAtom.x / canvas.width;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>draggedAtom.relY = draggedAtom.y / canvas.height;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>draggedAtom.vx = 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>draggedAtom.vy = 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>function loop() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>ctx.clearRect(0, 0, canvas.width, canvas.height);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>handleDragging();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const step = 0.015;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>let finishedTransfer = true;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>atoms.forEach(a =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>a.draw();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>a.electrons.forEach(e =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>if (e.isTransferring) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>finishedTransfer = false;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>e.progress += step;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>if (e.progress &gt;= 1) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>e.progress = 1;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>e.isTransferring = false;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>e.atom.electrons = e.atom.electrons.filter(el =&gt; el !== e);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>e.atom = e.targetAtom;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>e.shellIndex = e.targetAtom.currentShells.length;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>e.targetAtom.electrons.push(e);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>e.targetAtom = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>e.atom.rebalanceElectrons();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (isIonizing &amp;&amp; finishedTransfer) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if (!transferComplete) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>transferComplete = true;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>atoms.forEach(a =&gt; { a.isIon = true; a.rebalanceElectrons(); });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const attractionForce = 0.0012;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const damping = 0.8;<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>let totalMovement = 0;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>for (let i = 0; i &lt; atoms.length; i++) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>for (let j = i + 1; j &lt; atoms.length; j++) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>const a = atoms[i];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>const b = atoms[j];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>const dx = b.x - a.x;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>const dy = b.y - a.y;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>const dist = Math.sqrt(dx * dx + dy * dy);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>const minDist = a.getRadius() + b.getRadius();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>const margin = 2;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>if (a.isMetal !== b.isMetal) {<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>if (dist &gt; minDist + margin &amp;&amp; (draggedAtom !== a &amp;&amp; draggedAtom !== b)) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>const fx = (dx / dist) * attractionForce;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>const fy = (dy / dist) * attractionForce;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>a.vx += fx; a.vy += fy;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>b.vx -= fx; b.vy -= fy;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>if (dist &lt; minDist) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>const overlap = minDist - dist;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>const nx = dx / (dist || 1);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>const ny = dy / (dist || 1);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>if (draggedAtom === a) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>b.relX += (nx * overlap) / canvas.width;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>b.relY += (ny * overlap) / canvas.height;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>} else if (draggedAtom === b) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>a.relX -= (nx * overlap) / canvas.width;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>a.relY -= (ny * overlap) / canvas.height;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>a.relX -= (nx * overlap * 0.5) / canvas.width;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>a.relY -= (ny * overlap * 0.5) / canvas.height;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>b.relX += (nx * overlap * 0.5) / canvas.width;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>b.relY += (ny * overlap * 0.5) / canvas.height;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>a.vx *= 0.4; a.vy *= 0.4;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>b.vx *= 0.4; b.vy *= 0.4;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>atoms.forEach(a =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>if (draggedAtom !== a) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>a.relX += a.vx;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>a.relY += a.vy;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>a.vx *= damping;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>a.vy *= damping;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>totalMovement += Math.abs(a.vx) + Math.abs(a.vy);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if (draggedAtom) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>stateLabel.innerText = "Interacting...";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>stateLabel.className = "text-sm font-bold text-purple-600 bg-white p-3 border border-purple-200 rounded-lg text-center shadow-sm";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>} else if (totalMovement &lt; 0.00004) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>stateLabel.innerText = "Stable Ionic Bond";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>stateLabel.className = "text-sm font-bold text-green-600 bg-white p-3 border border-green-200 rounded-lg text-center shadow-sm";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>stateLabel.innerText = "Attracting Ions...";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>stateLabel.className = "text-sm font-bold text-orange-500 bg-white p-3 border border-orange-100 rounded-lg text-center shadow-sm";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>requestAnimationFrame(loop);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>canvas.addEventListener('mousedown', (e) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const rect = canvas.getBoundingClientRect();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const scaleX = canvas.width / rect.width;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const scaleY = canvas.height / rect.height;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const mx = (e.clientX - rect.left) * scaleX;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const my = (e.clientY - rect.top) * scaleY;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>for (let i = atoms.length - 1; i &gt;= 0; i--) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const a = atoms[i];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const dx = mx - a.x;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const dy = my - a.y;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if (Math.sqrt(dx * dx + dy * dy) &lt; a.hitRadius) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>draggedAtom = a;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>window.addEventListener('mousemove', (e) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const rect = canvas.getBoundingClientRect();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const scaleX = canvas.width / rect.width;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const scaleY = canvas.height / rect.height;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>mousePos.x = (e.clientX - rect.left) * scaleX;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>mousePos.y = (e.clientY - rect.top) * scaleY;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>window.addEventListener('mouseup', () =&gt; draggedAtom = null);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>function resize() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const rect = canvas.getBoundingClientRect();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>canvas.width = rect.width;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>canvas.height = rect.height;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>window.addEventListener('resize', resize);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>compoundSelect.onchange = setupCompound;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ionizeBtn.onclick = triggerIonization;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>resetBtn.onclick = setupCompound;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>resize();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>setupCompound();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>loop();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/script&gt;</span></p>
<p class="p1"><span class="s1">&lt;/body&gt;</span></p>
<p class="p1"><span class="s1">&lt;/html&gt;</span></p>
</body>
</html>
